# User simulator for chatbot testing

##Description
The evolution of technology increased the complexity of chatbots and also it's testing methods. With the introduction of LLMs, chatbots are capable of humanizing
conversations and imitating the pragmatics of natural language. Several approaches have been created in order to evaluate the
performance of chatbots. The code in this project allows creating test cases based in conversations that a user simulator will have
with the chatbot to test.

## Usage

In order to run the simulator, a specific chatbot should be deployed previously (i.e Taskyto, Rasa...). 
The script "autorun.py" contains the functions to load the user simulator profile, start a conversation with the chatbot 
and save this conversation and its configuration par√°meters. The user simulator profile is stored in yaml files,
which should be located in some folder (`user_sim/yaml/user_sim_bikesqa.yaml`).

## Environment Configuration

API keys can be set as environment variables.
The most important API key is `OPENAI_API_KEY`.

## User Profile YAML Configuration

This file contains all the properties the user will follow in order to carry out the conversation. Sice the user simulator is
based in OpenAI GPT4-o LLM technology, some of the fields should be written as prompts in natural language. For this fileds, a 
prompt engineering task should be carried out by the programmer to narrow down the role of the user simulator and guide its
behaviour. A description of the fields and an exaple of the YAML structure is described below.

```
# (float) parameter that controls the randomness and diversity of the responses generated by the LLM.
temperature: 0.8                      

# (bool) defines wether the user simulator or the chatbot will start the conversation.
isstarter: True                       

# (str) the chatbot's own fallback message should be written in this field in order to allow the user simulator to detect fallbacks
fallback:
  I'm sorry it's a little loud in my pizza shop, can you say that again?

# (str) this is the main role the user will perform
role:                                 
  you have to act as a user ordering a pizza to a pizza shop

# (list of str) this are some features addeed to the prompt in order to narrow down the user's role
context:                              
  - Since you're the user, just tell what you want to order

# (list of types) this field allows the programmer to define what should be said by the user simulator to test tome specific capabilities of the chatbot.
# This field can process text with variables, which should be indicated as shown in the example.
ask_about:
  - "a pizza with any size of the following: {{size}}"
  - size:
    - small
    - medium
    - large
    - extra large
  - "any of the following for toppings: {{toppings}}"
  - toppings:
    - mushrooms
    - tomato
    - onion
    - cheese
    - olives
    - pepperoni

# (list of dict) In this field some parameters should be defined, such as the number of conversations to generate,
# the goal style to end the conversation, and the interaction style to carry out in the conversation. Below is shown an example of implementation, next up, a breakdown of each parameter will be performed
conversations:
  - number: 1
  - goal_style:
        steps: 5
  - interaction_style:
      - change language:
          - italian
          - portuguese
          - chinese

# number: number of conversations to generate
# goal_style: this defines how the conversation should end. There are 3 options in this update
#    - steps: a limit number of interactions should be done before the conversation ends
#    - all answered: the conversation will end as long as all the queries in "ask_about" have been asked by the user
#                    and answered by the chatbot. This option is still flaky in some cases where the user has
#                    to provide data instead of asking for information to the chatbot.
#    - default: the default mode enables "all answered" mode, since no steps are defined.
# interaction_style: this indicates how the user simulator should carry out the conversation. There are 7 options in this update
#    - long phrase: the user will use very long phrases to write any query.
#    - change your mind: the user will change its mind eventually. Useful in conversations when the user has to
#                        provide information, such as toppings on a pizza, an appointment date...
#    - change language: the user will change the language in the middle of a conversation. This should be defined as a list
#                       of languages inside the parameter, as shown in the example above.
#    - make spelling mistakes: the user will make typos and spelling mistakes during the conversation
#    - single question: the user makes only one query per interaction from "ask_about" field.
#    - all questions: the user asks everyrhing inside the "ask_about" field in one interaction.
#    - default: the user simulator will carry out the conversation in a normal way.
```
